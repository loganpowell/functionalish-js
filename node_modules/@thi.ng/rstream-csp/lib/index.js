'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var rstream = require('@thi.ng/rstream');

const fromChannel = (src, opts) => {
    opts = { id: `channel-${src.id}`, closeChannel: true, ...opts };
    return new rstream.Stream((stream) => {
        let isActive = true;
        (async () => {
            let x;
            while (((x = null), (x = await src.read())) !== undefined) {
                if (x === undefined || !isActive) {
                    break;
                }
                stream.next(x);
            }
            stream.done();
        })();
        return () => {
            if (opts.closeChannel !== false) {
                src.close(true);
                rstream.LOGGER.info("closed channel", src.id);
            }
            isActive = false;
        };
    }, opts);
};

exports.fromChannel = fromChannel;
