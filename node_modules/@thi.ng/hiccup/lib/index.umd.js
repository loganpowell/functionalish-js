!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@thi.ng/checks"),require("@thi.ng/errors")):"function"==typeof define&&define.amd?define(["exports","@thi.ng/checks","@thi.ng/errors"],t):t(((e=e||self).thi=e.thi||{},e.thi.ng=e.thi.ng||{},e.thi.ng.hiccup={}),e.thi.ng.checks,e.thi.ng.errors)}(this,(function(e,t,n){"use strict";const i={"?xml":"?>\n","!DOCTYPE":">\n","!ENTITY":">\n","!ELEMENT":">\n","!ATTLIST":">\n"},r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},l=/^([^\s\.#]+)(?:#([^\s\.#]+))?(?:\.([^\s#]+))?$/,o=new RegExp(`[${Object.keys(r).join("")}]`,"g"),s={button:1,option:1,text:1,textarea:1},a=e=>e.split(" ").reduce((e,t)=>(e[t]=!0,e),{}),c=a("animate animateColor animateMotion animateTransform circle clipPath color-profile defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font foreignObject g image line linearGradient marker mask metadata mpath path pattern polygon polyline radialGradient rect set stop style svg switch symbol text textPath title tref tspan use view"),f=a("area base br circle col command ellipse embed hr img input keygen line link meta param path polygon polyline rect source stop track use wbr ?xml"),u=e=>{let n,i="";for(let r in e)n=e[r],t.isFunction(n)&&(n=n(e)),null!=n&&(i+=`${r}:${n};`);return i},g=e=>e.replace(o,e=>r[e]),p=e=>{let i,r,o,s=e[0];const a=t.isPlainObject(e[1]),c=a?Object.assign({},e[1]):{};return t.isString(s)&&(i=l.exec(s))||n.illegalArgs(`"${s}" is not a valid tag name`),s=i[1],r=i[2],o=i[3],r&&(c.id=r),o&&(o=o.replace(/\./g," "),c.class?c.class+=" "+o:c.class=o),e.length>1&&(t.isPlainObject(c.style)&&(c.style=u(c.style)),(e=e.slice(a?2:1).filter(e=>null!=e)).length>0)?[s,c,e]:[s,c]},h=(e,n,i,r,l,o)=>null==e?"":Array.isArray(e)?d(e,n,i,r,l,o):t.isFunction(e)?h(e(n),n,i,r,l,o):t.implementsFunction(e,"toHiccup")?h(e.toHiccup(n),n,i,r,l,o):t.implementsFunction(e,"deref")?h(e.deref(),n,i,r,l,o):t.isNotStringAndIterable(e)?T(e,n,i,r,l,o):(e=i?g(e.toString()):e,r?`<span${l?` key="${o.join("-")}"`:""}>${e}</span>`:e),d=(e,r,l,o,s,a)=>{if(!e.length)return"";let c=e[0];if(t.isFunction(c))return h(c.apply(null,[r,...e.slice(1)]),r,l,o,s,a);if(t.implementsFunction(c,"render"))return h(c.render.apply(null,[r,...e.slice(1)]),r,l,o,s,a);if("__COMMENT__"===c)return y(e);if(t.isString(c)){c=(e=p(e))[0];const t=e[1];if(t.__skip||!1===t.__serialize)return"";let n=e[2],u=`<${c}`;return s&&void 0===t.key&&(t.key=a.join("-")),u+=m(t,l),u+=n?_(c,n,r,l,o,s,a):f[c]?i[c]||"/>":`></${c}>`,u}return t.isNotStringAndIterable(e)?T(e,r,l,o,s,a):n.illegalArgs(`invalid tree node: ${e}`)},m=(e,n)=>{let i="";for(let r in e){if(r.startsWith("__"))continue;let l=e[r];null!=l&&(t.isFunction(l)&&(/^on\w+/.test(r)||null==(l=l(e)))||(!0===l?i+=" "+r:!1!==l&&(l=l.toString(),l.length&&(i+=` ${r}="${n?g(l):l}"`))))}return i},_=(e,t,r,l,o,a,c)=>{f[e]&&n.illegalArgs(`No body allowed in tag: ${e}`);const u=i[e];let g=u?" ":">";o=o&&!u&&!s[e];for(let e=0,n=t.length;e<n;e++)g+=h(t[e],r,l,o,a,[...c,e]);return g+(u||`</${e}>`)},y=e=>e.length>2?`\n\x3c!--\n${e.slice(1).map(e=>"    "+e).join("\n")}\n--\x3e\n`:`\n\x3c!-- ${e[1]} --\x3e\n`,T=(e,t,n,i,r,l)=>{const o=[],s=l.slice(0,l.length-1);let a=0;for(let l of e)o.push(h(l,t,n,i,r,[...s,a++]));return o.join("")};e.COMMENT="__COMMENT__",e.ENTITIES=r,e.NO_SPANS=s,e.PROC_TAGS=i,e.RE_ENTITY=o,e.RE_TAG=l,e.SVG_NS="http://www.w3.org/2000/svg",e.SVG_TAGS=c,e.VOID_TAGS=f,e.XHTML_NS="http://www.w3.org/1999/xhtml",e.XLINK_NS="http://www.w3.org/1999/xlink",e.css=u,e.derefContext=(e,n)=>{if(null==e||!n||!n.length)return e;const i=Object.assign({},e);for(let e of n){const n=i[e];t.implementsFunction(n,"deref")&&(i[e]=n.deref())}return i},e.escape=g,e.normalize=p,e.serialize=(e,t,n=!1,i=!1,r=i,l=[0])=>h(e,t,n,i,r,l),Object.defineProperty(e,"__esModule",{value:!0})}));