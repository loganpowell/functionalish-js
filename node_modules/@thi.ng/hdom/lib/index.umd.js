!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@thi.ng/api"),require("@thi.ng/diff"),require("@thi.ng/equiv"),require("@thi.ng/checks"),require("@thi.ng/hiccup"),require("@thi.ng/errors")):"function"==typeof define&&define.amd?define(["exports","@thi.ng/api","@thi.ng/diff","@thi.ng/equiv","@thi.ng/checks","@thi.ng/hiccup","@thi.ng/errors"],t):t(((e=e||self).thi=e.thi||{},e.thi.ng=e.thi.ng||{},e.thi.ng.hdom={}),e.thi.ng.api,e.thi.ng.diff,e.thi.ng.equiv,e.thi.ng.checks,e.thi.ng.hiccup,e.thi.ng.errors)}(this,(function(e,t,r,n,i,s,o){"use strict";const l=Array.isArray,a=Math.max,c=Object.getPrototypeOf({}),f="function",d="string",u=(()=>{const e=new Array(2048);for(let t=2,r=e.length;t<r;t++)e[t]=t-2;return e})(),h=(e,t,n,i,s,o=0)=>{const l=s[1];if(l.__skip)return;if(!1===l.__diff)return v(i),void t.replaceChild(e,n,o,s);const a=i[1];if(a&&a.__skip)return void t.replaceChild(e,n,o,s,!1);let c=l.__impl;if(c&&c!==t)return c.diffTree(e,c,n,i,s,o);const f=r.diffArray(i,s,1,A);if(0===f.distance)return;const d=f.linear,h=t.getChild(n,o);let _,y,T;if(0!==d[0]||i[1].key!==l.key)return v(i),void t.replaceChild(e,n,o,s);if((T=i.__release)&&T!==s.__release&&v(i),0!==d[3]&&(m(t,h,i[1],s[1]),2===f.distance))return;const x=d.length,E=i.length-1,k=b(d),O=(e=>{if(e<=u.length)return u.slice(0,e);const t=new Array(e);for(;--e>=2;)t[e]=e-2;return t})(E+1);for(_=6;_<x;_+=3)y=d[_],y&&(-1===y?p(e,t,h,i,s,d,_,k,O,E):g(e,t,h,d,_,k,O,E));(T=s.__init)&&T!=i.__init&&T.apply(s,[h,...s.__args])},p=(e,t,r,n,i,s,o,a,c,f)=>{const u=s[o+2];if(l(u)){let l=u[1].key;if(void 0!==l&&void 0!==a[l][2]){const s=a[l];l=s[0],h(e,t,r,n[l],i[s[2]],c[l])}else{const e=s[o+1];v(u),t.removeChild(r,c[e]),_(c,f,e)}}else typeof u===d&&t.setContent(r,"")},g=(e,t,r,n,i,s,o,a)=>{const c=n[i+2];if(typeof c===d)t.setContent(r,c);else if(l(c)){const l=c[1].key;if(void 0===l||void 0===s[l][0]){const s=n[i+1];t.createTree(e,r,c,o[s]),y(o,a,s)}}},_=(e,t,r)=>{for(;t>r;t--)e[t]=a(e[t]-1,0)},y=(e,t,r)=>{for(;t>=r;t--)e[t]++},m=(e,i,s,o)=>{const l=r.diffObject(s,o,3,n.equiv);e.removeAttribs(i,l.dels,s);let a,c,f,d=t.SEMAPHORE;for(f=l.edits,a=f.length;(a-=2)>=0;)c=f[a],0===c.indexOf("on")&&e.removeAttribs(i,[c],s),"value"!==c?e.setAttrib(i,c,f[a+1],o):d=f[a+1];for(f=l.adds,a=f.length;--a>=0;)c=f[a],"value"!==c?e.setAttrib(i,c,o[c],o):d=o[c];d!==t.SEMAPHORE&&e.setAttrib(i,"value",d,o)},v=e=>{if(l(e)){let t;if((t=e[1])&&!1===t.__release)return;for(e.__release&&(e.__release.apply(e.__this,e.__args),delete e.__release),t=e.length;--t>=2;)v(e[t])}},b=e=>{let t,r,n;const i={};for(let s=e.length;(s-=3)>=0;)r=e[s+2],l(r)&&void 0!==(t=r[1].key)&&(n=i[t],!n&&(i[t]=n=[,,]),n[e[s]+1]=e[s+1]);return i},A=(e,t)=>{let r;return e===t||(null==e?e==t:typeof e.equiv===f?e.equiv(t):null==t?e==t:typeof t.equiv===f?t.equiv(e):typeof e!==d&&typeof t!==d&&(r=Object.getPrototypeOf(e),null!=r&&r!==c||(r=Object.getPrototypeOf(t),null!=r&&r!==c)?typeof e!==f&&void 0!==e.length&&typeof t!==f&&void 0!==t.length?n.equivArrayLike(e,t,A):e instanceof Set&&t instanceof Set?n.equivSet(e,t,A):e instanceof Map&&t instanceof Map?n.equivMap(e,t,A):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:!(!1===e.__diff||!1===t.__diff)&&n.equivObject(e,t,A)))},T=i.isArray,x=i.isNotStringAndIterable,E=(e,t)=>t.__init&&t.__init.apply(t.__this,[e,...t.__args]),k=(e,t,r,n,i,s=!0)=>{if(T(n)){const o=n[0];if("function"==typeof o)return k(e,t,r,o.apply(null,[e.ctx,...n.slice(1)]),i);const l=n[1];if(l.__impl)return l.__impl.createTree(e,r,n,i,s);const a=t.createElement(r,o,l,i);if(n.length>2){const r=n.length;for(let i=2;i<r;i++)k(e,t,a,n[i],void 0,s)}return s&&E(a,n),a}if(x(n)){const o=[];for(let l of n)o.push(k(e,t,r,l,i,s));return o}return null==n?r:t.createTextElement(r,n)},O=(e,t,r,n,i=0)=>{if(T(n)){const s=t.getChild(r,i);"function"==typeof n[0]&&O(e,t,r,n[0].apply(null,[e.ctx,...n.slice(1)]),i);const o=n[1];if(o.__impl)return o.__impl.hydrateTree(e,r,n,i);E(s,n);for(let e in o)0===e.indexOf("on")&&t.setAttrib(s,e,o[e]);for(let r=n.length,i=2;i<r;i++)O(e,t,s,n[i],i-2)}else if(x(n))for(let s of n)O(e,t,r,s,i),i++},C=(e,t,r,n)=>{const i=s.SVG_TAGS[t]?document.createElementNS(s.SVG_NS,t):document.createElement(t);return r&&G(i,r),q(e,i,n)},S=(e,t,r)=>q(e,document.createTextNode(t),r),q=(e,t,r)=>e?void 0===r?e.appendChild(t):e.insertBefore(t,e.children[r]):t,L=(e,t)=>e.children[t],j=(e,t,r,n,i,s=!0)=>(t.removeChild(r,n),t.createTree(e,r,i,n,s)),N=(e,t)=>e.textContent=t,G=(e,t)=>{for(let r in t)M(e,r,t[r],t);return e},M=(e,t,r,n)=>{if(t.startsWith("__"))return;const i=0===t.indexOf("on");if(i||"function"!=typeof r||(r=r(n)),void 0!==r&&!1!==r)switch(t){case"style":z(e,r);break;case"value":R(e,r);break;case"accesskey":e.accessKey=r;break;case"contenteditable":e.contentEditable=r;break;case"tabindex":e.tabIndex=r;break;case"align":case"autocapitalize":case"checked":case"dir":case"draggable":case"hidden":case"id":case"lang":case"namespaceURI":case"scrollTop":case"scrollLeft":case"title":e[t]=r;break;default:i?I(e,t.substr(2),r):e.setAttribute(t,!0===r?"":r)}else null!=e[t]?e[t]=null:e.removeAttribute(t);return e},R=(e,t)=>{let r;switch(e.type){case"text":case"textarea":case"password":case"search":case"number":case"email":case"url":case"tel":case"date":case"datetime-local":case"time":case"week":case"month":if(void 0!==(r=e.value)&&"string"==typeof t){const n=t.length-(r.length-(e.selectionStart||0));e.value=t,e.selectionStart=e.selectionEnd=n;break}default:e.value=t}},P=(e,t,r)=>{for(let n=t.length;--n>=0;){const i=t[n];0===i.indexOf("on")?w(e,i.substr(2),r[i]):e.hasAttribute(i)?e.removeAttribute(i):e[i]=null}},z=(e,t)=>(e.setAttribute("style",s.css(t)),e),I=(e,t,r)=>T(r)?e.addEventListener(t,...r):e.addEventListener(t,r),w=(e,t,r)=>T(r)?e.removeEventListener(t,...r):e.removeEventListener(t,r),D=(e,t)=>{const r=e.children[t];void 0!==r&&e.removeChild(r)},H=i.isArray,B=i.isNotStringAndIterable,F=i.isPlainObject,K=(e,t)=>{let r,n,i,l,a,c=e[0],f=F(e[1]);return"string"==typeof c&&(r=s.RE_TAG.exec(c))||o.illegalArgs(`${c} is not a valid tag name`),n=r[1],c!==n||!f||t&&!e[1].key?(a=f?Object.assign({},e[1]):{},i=r[2],l=r[3],i&&(a.id=i),l&&(l=l.replace(/\./g," "),a.class?a.class+=" "+l:a.class=l),a.__skip&&e.length<3?[n,a]:[n,a,...e.slice(f?2:1)]):e},U=(e,t)=>V(t,e,e.ctx,[0],!1!==e.keys,!1!==e.span),V=(e,t,r,n,i,o)=>{if(null!=e){if(H(e)){if(0===e.length)return;let l,a,c=e[1];if(c&&(a=c.__impl)&&(a=a.normalizeTree))return a(t,e);const f=e[0];if("function"==typeof f)return V(f.apply(null,[r,...e.slice(1)]),t,r,n,i,o);if("function"==typeof f.render){const s=[r,...e.slice(1)];return l=V(f.render.apply(f,s),t,r,n,i,o),H(l)&&(l.__this=f,l.__init=f.init,l.__release=f.release,l.__args=s),l}if(l=K(e,i),c=l[1],!1===c.__normalize)return l;if(i&&void 0===c.key&&(c.key=n.join("-")),l.length>2){const e=l[0],a=[e,c];o=o&&!s.NO_SPANS[e];for(let e=2,s=2,c=0,f=l.length;e<f;e++){let f=l[e];if(null!=f){const e=H(f);if(e&&H(f[0])||!e&&B(f))for(let e of f)e=V(e,t,r,n.concat(c),i,o),void 0!==e&&(a[s++]=e),c++;else f=V(f,t,r,n.concat(c),i,o),void 0!==f&&(a[s++]=f),c++}}return a}return l}return"function"==typeof e?V(e(r),t,r,n,i,o):"function"==typeof e.toHiccup?V(e.toHiccup(t.ctx),t,r,n,i,o):"function"==typeof e.deref?V(e.deref(),t,r,n,i,o):o?["span",i?{key:n.join("-")}:{},e.toString()]:e.toString()}},W={createTree(e,t,r,n,i){return k(e,this,t,r,n,i)},hydrateTree(e,t,r,n){return O(e,this,t,r,n)},diffTree(e,t,r,n,i){h(e,this,t,r,n,i)},normalizeTree:U,getElementById:e=>document.getElementById(e),getChild:L,createElement:C,createTextElement:S,replaceChild(e,t,r,n,i){j(e,this,t,r,n,i)},removeChild:D,setContent:N,removeAttribs:P,setAttrib:M};e.LOGGER=t.NULL_LOGGER;const $=(e,t)=>i.isString(e)?t.getElementById(e):e;e.DEFAULT_IMPL=W,e.addChild=q,e.clearDOM=e=>e.innerHTML="",e.cloneWithNewAttribs=(e,t)=>{const r=e.cloneNode(!0);return G(r,t),e.parentNode.replaceChild(r,e),r},e.createElement=C,e.createTextElement=S,e.createTree=k,e.diffAttributes=m,e.diffTree=h,e.equiv=A,e.getChild=L,e.hydrateTree=O,e.normalizeElement=K,e.normalizeTree=U,e.releaseTree=v,e.removeAttribs=P,e.removeChild=D,e.removeListener=w,e.renderOnce=(e,t={},r=W)=>{(t=Object.assign({root:"app"},t)).ctx=s.derefContext(t.ctx,t.autoDerefKeys);const n=$(t.root,r);(e=r.normalizeTree(t,e))&&(t.hydrate?r.hydrateTree(t,n,e):r.createTree(t,n,e))},e.replaceChild=j,e.resolveRoot=$,e.setAttrib=M,e.setAttribs=G,e.setContent=N,e.setListener=I,e.setLogger=t=>e.LOGGER=t,e.setStyle=z,e.start=(e,t={},r=W)=>{const n=Object.assign({root:"app"},t);let i=[],o=!0;const l=$(n.root,r),a=()=>{if(o){n.ctx=s.derefContext(t.ctx,n.autoDerefKeys);const c=r.normalizeTree(n,e);null!=c&&(n.hydrate?(r.hydrateTree(n,l,c),n.hydrate=!1):r.diffTree(n,l,i,c),i=c),o&&requestAnimationFrame(a)}};return requestAnimationFrame(a),()=>o=!1},e.updateValueAttrib=R,Object.defineProperty(e,"__esModule",{value:!0})}));