'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var hdom = require('@thi.ng/hdom');
var hiccup = require('@thi.ng/hiccup');
var transducers = require('@thi.ng/transducers');

const updateDOM = (opts = {}, impl = hdom.DEFAULT_IMPL) => {
    const _opts = Object.assign({ root: "app" }, opts);
    const root = hdom.resolveRoot(_opts.root, impl);
    return transducers.scan([
        () => [],
        (acc) => acc,
        (prev, curr) => {
            _opts.ctx = hiccup.derefContext(opts.ctx, _opts.autoDerefKeys);
            curr = impl.normalizeTree(_opts, curr);
            if (curr != null) {
                if (_opts.hydrate) {
                    impl.hydrateTree(_opts, root, curr);
                    _opts.hydrate = false;
                }
                else {
                    impl.diffTree(_opts, root, prev, curr, 0);
                }
                return curr;
            }
            return prev;
        }
    ]);
};

exports.updateDOM = updateDOM;
